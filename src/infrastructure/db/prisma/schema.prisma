generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum AssetType {
  FIAT
  CRYPTO
  STOCK
  RE
  DEBT
  COMMODITY
}

enum ValuationMode {
  MARKET
  MANUAL
}

model User {
  id            String          @id @default(uuid())
  telegramId    BigInt          @unique
  username      String
  createdAt     DateTime        @default(now())
  assets        Asset[]
  DailySnapshot DailySnapshot[]
}

model Asset {
  id            String        @id @default(uuid())
  userId        String
  name          String
  type          AssetType
  currency      String
  qty           Decimal       @db.Decimal(38, 12)
  valuationMode ValuationMode @default(MARKET)
  total         Decimal?      @db.Decimal(38, 2)
  debt          Decimal?      @db.Decimal(38, 2)

  createdAt DateTime @default(now())

  user      User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  snapshots DailySnapshot[]

  @@index([userId])
}

model DailySnapshot {
  id            String        @id @default(uuid())
  assetId       String
  userId        String
  name          String
  type          AssetType
  currency      String
  qty           Decimal       @db.Decimal(38, 12)
  valuationMode ValuationMode @default(MARKET)
  total         Decimal?      @db.Decimal(38, 2)
  debt          Decimal?      @db.Decimal(38, 2)

  valuesJson Json
  metaJson   Json?

  dateTime DateTime @default(now())
  asset    Asset    @relation(fields: [assetId], references: [id])
  user     User     @relation(fields: [userId], references: [id])

  @@unique([assetId, dateTime])
  @@index([dateTime])
}
